<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Gunshot Detection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <h1>Real-Time Gunshot Detection</h1>

    <!-- Real-Time Volume Stream -->
    <h3>Real-Time Volume: <span id="real_time_volume">-</span> dB</h3>

    <!-- Display First Three Events -->
    <h3>Latest Events:</h3>
    <ul id="log_list">
        <!-- Logs will be dynamically populated here -->
    </ul>

    <h3>Full Logs: <a href="/logs" target="_blank">View All Logs</a></h3>

    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);

        // Listen for real-time volume
        socket.on('volume_stream', function(data) {
            document.getElementById('real_time_volume').innerText = data.volume.toFixed(2);
        });

        // Listen for logged events
        const logList = document.getElementById('log_list');
        socket.on('log_event', function(event) {
            // Create a log entry
            const logEntry = document.createElement('li');
            logEntry.innerText = `[${event.time}] Volume: ${event.volume} dB, Prediction: ${event.prediction}, Confidence: ${event.confidence}%`;

            // Add to the log list
            logList.prepend(logEntry);  // Add at the top

            // Remove excess logs to show only 3
            while (logList.children.length > 3) {
                logList.removeChild(logList.lastChild);
            }
        });

        socket.on('connect', function() {
            console.log("Connected to the server.");
        });
    </script>
</body>
</html>
